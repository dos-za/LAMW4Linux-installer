#!/bin/bash -x
#-------------------------------------------------------------------------------------------------#
#Universidade federal de Mato Grosso (Alma Mater)
#Course: Science Computer
#Version  0.3.3
#Date: 11/12/2019
#Description: This script generates compiles LAMW Manager source code into an executable installer.
#Note: This script requires makeself, read more in https://makeself.io/
#-------------------------------------------------------------------------------------------------#

source "../core/common-shell.sh"


AUX=$PWD
DESTPATH=${AUX/%\.build}
LAMW_MANAGER_TMP_BUILD="/tmp/lamw_manager_build"
LAMW_MANAGER_INSTALLER="lamw_manager_setup.run"
LAMW_MANAGER_FINAL_INSTALLER="$LAMW_MANAGER_TMP_BUILD/$LAMW_MANAGER_INSTALLER"
if [ ! -e $LAMW_MANAGER_TMP_BUILD ]
then
	mkdir $LAMW_MANAGER_TMP_BUILD
fi
files=(
	"../core"
	"../docs"
	"../lamw_manager"	
	".start_lamw_manager"
	"../../Getting Started.txt"
)
qt=${#files[*]}

#copy directorys and files to LAMW_MANAGER_TMP_BUILD
for((i=0;i<qt;i++))
do 
	if [ -e "${files[i]}" ]; then
		if [ -d "${files[i]}" ]; then # if files[i] is a directory 
			cp  -r "${files[i]}" "$LAMW_MANAGER_TMP_BUILD"
		else
			cp  "${files[i]}" "$LAMW_MANAGER_TMP_BUILD"
		fi
	fi
done

changeDirectory $LAMW_MANAGER_TMP_BUILD
makeself   --gzip --copy --target '$HOME/lamw_manager' $PWD $LAMW_MANAGER_INSTALLER "LAMW Manager Setup"  ./.start_lamw_manager
cp "$LAMW_MANAGER_FINAL_INSTALLER" "$DESTPATH"

if [ -e $LAMW_MANAGER_TMP_BUILD ]; then
	rm -r $LAMW_MANAGER_TMP_BUILD
fi